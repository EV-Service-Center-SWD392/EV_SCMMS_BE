@startuml SparepartManagement_Overview

' ===== STYLE =====
skinparam linetype ortho
skinparam class {
  BackgroundColor<<WebAPI>> LightBlue
  BackgroundColor<<Application>> LightGreen
  BackgroundColor<<Infrastructure>> LightYellow
  BackgroundColor<<Domain>> LightCoral
  BorderColor Black
  ArrowColor Black
}

' ===== WEBAPI =====
package "WebAPI Layer" {
  class SparepartController <<WebAPI>> {
    + GetAll()
    + GetById(Guid)
    + Create(CreateSparepartDto)
    + Update(Guid, UpdateSparepartDto)
    + Delete(Guid)
    + GetByType(Guid)
    + GetByInventory(Guid)
  }

  class SparepartTypeController <<WebAPI>> {
    + GetAll()
    + GetById(Guid)
    + Create(CreateSparepartTypeDto)
    + Update(Guid, UpdateSparepartTypeDto)
    + Delete(Guid)
  }

  class SparepartForecastController <<WebAPI>> {
    + GetAll()
    + GetById(Guid)
    + Create(CreateSparepartForecastDto)
    + Update(Guid, UpdateSparepartForecastDto)
    + Delete(Guid)
    + GetBySparepart(Guid)
    + GetByCenter(Guid)
    + Approve(Guid, ApproveDto)
  }

  class SparepartReplenishmentRequestController <<WebAPI>> {
    + GetAll()
    + GetById(Guid)
    + Create(CreateReplenishmentRequestDto)
    + Update(Guid, UpdateReplenishmentRequestDto)
    + Delete(Guid)
    + GetByStatus(string)
    + Approve(Guid, ApproveRequestDto)
    + Reject(Guid, RejectRequestDto)
    + GetPending()
  }

  class SparepartUsageHistoryController <<WebAPI>> {
    + GetAll()
    + GetById(Guid)
    + Create(CreateUsageHistoryDto)
    + Update(Guid, UpdateUsageHistoryDto)
    + Delete(Guid)
    + GetBySparepart(Guid)
    + GetByCenter(Guid)
  }

  class InventoryController <<WebAPI>> {
    + GetAll()
    + GetById(Guid)
    + Create(CreateInventoryDto)
    + Update(Guid, UpdateInventoryDto)
    + GetByCenter(Guid)
    + CheckLowStock()
  }
}

' ===== APPLICATION =====
package "Application Layer" {

  interface ISparepartService <<Application>> {
    + GetAllAsync(): Task<IServiceResult<List<SparepartDto>>>
    + GetByIdAsync(Guid): Task<IServiceResult<SparepartDto>>
    + CreateAsync(CreateSparepartDto): Task<IServiceResult<SparepartDto>>
    + UpdateAsync(Guid, UpdateSparepartDto): Task<IServiceResult<SparepartDto>>
    + DeleteAsync(Guid): Task<IServiceResult<bool>>
    + GetByTypeIdAsync(Guid): Task<IServiceResult<List<SparepartDto>>>
    + GetByInventoryIdAsync(Guid): Task<IServiceResult<List<SparepartDto>>>
  }

  interface ISparepartTypeService <<Application>> {
    + GetAllAsync(): Task<IServiceResult<List<SparepartTypeDto>>>
    + GetByIdAsync(Guid): Task<IServiceResult<SparepartTypeDto>>
    + CreateAsync(CreateSparepartTypeDto): Task<IServiceResult<SparepartTypeDto>>
    + UpdateAsync(Guid, UpdateSparepartTypeDto): Task<IServiceResult<SparepartTypeDto>>
    + DeleteAsync(Guid): Task<IServiceResult<bool>>
  }

  interface ISparepartForecastService <<Application>> {
    + GetAllAsync(): Task<IServiceResult<List<SparepartForecastDto>>>
    + GetByIdAsync(Guid): Task<IServiceResult<SparepartForecastDto>>
    + CreateAsync(CreateSparepartForecastDto): Task<IServiceResult<SparepartForecastDto>>
    + UpdateAsync(Guid, UpdateSparepartForecastDto): Task<IServiceResult<SparepartForecastDto>>
    + DeleteAsync(Guid): Task<IServiceResult<bool>>
    + GetBySparepartIdAsync(Guid): Task<IServiceResult<List<SparepartForecastDto>>>
    + GetByCenterIdAsync(Guid): Task<IServiceResult<List<SparepartForecastDto>>>
    + ApproveAsync(Guid, ApproveDto): Task<IServiceResult<SparepartForecastDto>>
  }

  interface ISparepartReplenishmentRequestService <<Application>> {
    + GetAllAsync(): Task<IServiceResult<List<SparepartReplenishmentRequestDto>>>
    + GetByIdAsync(Guid): Task<IServiceResult<SparepartReplenishmentRequestDto>>
    + CreateAsync(CreateReplenishmentRequestDto): Task<IServiceResult<SparepartReplenishmentRequestDto>>
    + UpdateAsync(Guid, UpdateReplenishmentRequestDto): Task<IServiceResult<SparepartReplenishmentRequestDto>>
    + DeleteAsync(Guid): Task<IServiceResult<bool>>
    + GetByStatusAsync(string): Task<IServiceResult<List<SparepartReplenishmentRequestDto>>>
    + ApproveRequestAsync(Guid, ApproveRequestDto): Task<IServiceResult<SparepartReplenishmentRequestDto>>
    + RejectRequestAsync(Guid, RejectRequestDto): Task<IServiceResult<SparepartReplenishmentRequestDto>>
    + GetPendingRequestsAsync(): Task<IServiceResult<List<SparepartReplenishmentRequestDto>>>
  }

  interface ISparepartUsageHistoryService <<Application>> {
    + GetAllAsync(): Task<IServiceResult<List<SparepartUsageHistoryDto>>>
    + GetByIdAsync(Guid): Task<IServiceResult<SparepartUsageHistoryDto>>
    + CreateAsync(CreateUsageHistoryDto): Task<IServiceResult<SparepartUsageHistoryDto>>
    + UpdateAsync(Guid, UpdateUsageHistoryDto): Task<IServiceResult<SparepartUsageHistoryDto>>
    + DeleteAsync(Guid): Task<IServiceResult<bool>>
    + GetBySparepartIdAsync(Guid): Task<IServiceResult<List<SparepartUsageHistoryDto>>>
    + GetByCenterIdAsync(Guid): Task<IServiceResult<List<SparepartUsageHistoryDto>>>
  }

  interface IInventoryService <<Application>> {
    + GetAllAsync(): Task<IServiceResult<List<InventoryDto>>>
    + GetByIdAsync(Guid): Task<IServiceResult<InventoryDto>>
    + CreateAsync(CreateInventoryDto): Task<IServiceResult<InventoryDto>>
    + UpdateAsync(Guid, UpdateInventoryDto): Task<IServiceResult<InventoryDto>>
    + GetByCenterIdAsync(Guid): Task<IServiceResult<List<InventoryDto>>>
    + CheckLowStockAsync(): Task<IServiceResult<List<InventoryDto>>>
  }

  interface ISparepartRepository <<Application>> {
    + GetAllAsync(): Task<List<SparepartTuht>>
    + GetByIdAsync(Guid): Task<SparepartTuht?>
    + AddAsync(SparepartTuht): Task<SparepartTuht>
    + UpdateAsync(SparepartTuht): Task<SparepartTuht>
    + DeleteAsync(Guid): Task<bool>
    + GetByTypeIdAsync(Guid): Task<List<SparepartTuht>>
    + GetByInventoryIdAsync(Guid): Task<List<SparepartTuht>>
  }

  interface ISparepartTypeRepository <<Application>> {
    + GetAllAsync(): Task<List<SpareparttypeTuht>>
    + GetByIdAsync(Guid): Task<SpareparttypeTuht?>
    + AddAsync(SpareparttypeTuht): Task<SpareparttypeTuht>
    + UpdateAsync(SpareparttypeTuht): Task<SpareparttypeTuht>
    + DeleteAsync(Guid): Task<bool>
  }

  interface ISparepartForecastRepository <<Application>> {
    + GetAllAsync(): Task<List<SparepartforecastTuht>>
    + GetByIdAsync(Guid): Task<SparepartforecastTuht?>
    + AddAsync(SparepartforecastTuht): Task<SparepartforecastTuht>
    + UpdateAsync(SparepartforecastTuht): Task<SparepartforecastTuht>
    + DeleteAsync(Guid): Task<bool>
    + GetBySparepartIdAsync(Guid): Task<List<SparepartforecastTuht>>
    + GetByCenterIdAsync(Guid): Task<List<SparepartforecastTuht>>
  }

  interface ISparepartReplenishmentRequestRepository <<Application>> {
    + GetAllAsync(): Task<List<Sparepartreplenishmentrequest>>
    + GetByIdAsync(Guid): Task<Sparepartreplenishmentrequest?>
    + AddAsync(Sparepartreplenishmentrequest): Task<Sparepartreplenishmentrequest>
    + UpdateAsync(Sparepartreplenishmentrequest): Task<Sparepartreplenishmentrequest>
    + DeleteAsync(Guid): Task<bool>
    + GetByStatusAsync(string): Task<List<Sparepartreplenishmentrequest>>
    + GetPendingAsync(): Task<List<Sparepartreplenishmentrequest>>
  }

  interface ISparepartUsageHistoryRepository <<Application>> {
    + GetAllAsync(): Task<List<SparepartusagehistoryTuht>>
    + GetByIdAsync(Guid): Task<SparepartusagehistoryTuht?>
    + AddAsync(SparepartusagehistoryTuht): Task<SparepartusagehistoryTuht>
    + UpdateAsync(SparepartusagehistoryTuht): Task<SparepartusagehistoryTuht>
    + DeleteAsync(Guid): Task<bool>
    + GetBySparepartIdAsync(Guid): Task<List<SparepartusagehistoryTuht>>
    + GetByCenterIdAsync(Guid): Task<List<SparepartusagehistoryTuht>>
  }

  interface IInventoryRepository <<Application>> {
    + GetAllAsync(): Task<List<InventoryTuht>>
    + GetByIdAsync(Guid): Task<InventoryTuht?>
    + AddAsync(InventoryTuht): Task<InventoryTuht>
    + UpdateAsync(InventoryTuht): Task<InventoryTuht>
    + GetByCenterIdAsync(Guid): Task<List<InventoryTuht>>
    + GetLowStockAsync(): Task<List<InventoryTuht>>
  }

  interface IUnitOfWork <<Application>> {
    + SparepartRepository: ISparepartRepository
    + SparepartTypeRepository: ISparepartTypeRepository
    + SparepartForecastRepository: ISparepartForecastRepository
    + SparepartReplenishmentRequestRepository: ISparepartReplenishmentRequestRepository
    + SparepartUsageHistoryRepository: ISparepartUsageHistoryRepository
    + InventoryRepository: IInventoryRepository
    + SaveChangesAsync(): Task<int>
  }

  class SparepartDto <<Application>> {
    + SparepartId: Guid
    + VehicleModelId: int?
    + InventoryId: Guid?
    + TypeId: Guid?
    + Name: string
    + UnitPrice: decimal?
    + Manufacture: string?
    + Status: string?
  }

  class SparepartTypeDto <<Application>> {
    + TypeId: Guid
    + Name: string
    + Description: string?
    + Status: string?
  }

  class SparepartForecastDto <<Application>> {
    + ForecastId: Guid
    + SparepartId: Guid
    + CenterId: Guid
    + PredictedUsage: int?
    + SafetyStock: int?
    + ReorderPoint: int?
    + ForecastedBy: string?
    + ForecastConfidence: decimal?
    + Status: string?
  }

  class SparepartReplenishmentRequestDto <<Application>> {
    + RequestId: Guid
    + CenterId: Guid
    + SparepartId: Guid
    + ForecastId: Guid?
    + SuggestedQuantity: int?
    + ApprovedBy: Guid?
    + ApprovedAt: DateTime?
    + Notes: string?
    + Status: string?
  }

  class ApproveRequestDto <<Application>> {
    + ApprovedBy: Guid
    + Notes: string?
  }

  class RejectRequestDto <<Application>> {
    + RejectedBy: Guid
    + Reason: string
    + Notes: string?
  }

  class SparepartUsageHistoryDto <<Application>> {
    + UsageId: Guid
    + SparepartId: Guid
    + CenterId: Guid
    + OrderSparepartId: Guid?
    + QuantityUsed: int
    + UsedDate: DateTime?
    + Status: string?
  }

  class InventoryDto <<Application>> {
    + InventoryId: Guid
    + CenterId: Guid
    + Quantity: int?
    + MinimumStockLevel: int?
    + Status: string?
  }
}

' ===== INFRASTRUCTURE =====
package "Infrastructure Layer" {
  class SparepartService <<Infrastructure>> {
    - _unitOfWork: IUnitOfWork
    + GetAllAsync()
    + GetByIdAsync()
    + CreateAsync()
    + UpdateAsync()
    + DeleteAsync()
    + GetByTypeIdAsync()
    + GetByInventoryIdAsync()
  }

  class SparepartTypeService <<Infrastructure>> {
    - _unitOfWork: IUnitOfWork
    + GetAllAsync()
    + GetByIdAsync()
    + CreateAsync()
    + UpdateAsync()
    + DeleteAsync()
  }

  class SparepartForecastService <<Infrastructure>> {
    - _unitOfWork: IUnitOfWork
    + GetAllAsync()
    + GetByIdAsync()
    + CreateAsync()
    + UpdateAsync()
    + DeleteAsync()
    + GetBySparepartIdAsync()
    + GetByCenterIdAsync()
    + ApproveAsync()
  }

  class SparepartReplenishmentRequestService <<Infrastructure>> {
    - _unitOfWork: IUnitOfWork
    + GetAllAsync()
    + GetByIdAsync()
    + CreateAsync()
    + UpdateAsync()
    + DeleteAsync()
    + GetByStatusAsync()
    + ApproveRequestAsync()
    + RejectRequestAsync()
    + GetPendingRequestsAsync()
  }

  class SparepartUsageHistoryService <<Infrastructure>> {
    - _unitOfWork: IUnitOfWork
    + GetAllAsync()
    + GetByIdAsync()
    + CreateAsync()
    + UpdateAsync()
    + DeleteAsync()
    + GetBySparepartIdAsync()
    + GetByCenterIdAsync()
  }

  class InventoryService <<Infrastructure>> {
    - _unitOfWork: IUnitOfWork
    + GetAllAsync()
    + GetByIdAsync()
    + CreateAsync()
    + UpdateAsync()
    + GetByCenterIdAsync()
    + CheckLowStockAsync()
  }

  class SparepartRepository <<Infrastructure>> {
    - _context: AppDbContext
    + GetAllAsync()
    + GetByIdAsync()
    + AddAsync()
    + UpdateAsync()
    + DeleteAsync()
    + GetByTypeIdAsync()
    + GetByInventoryIdAsync()
  }

  class SparepartTypeRepository <<Infrastructure>> {
    - _context: AppDbContext
    + GetAllAsync()
    + GetByIdAsync()
    + AddAsync()
    + UpdateAsync()
    + DeleteAsync()
  }

  class SparepartForecastRepository <<Infrastructure>> {
    - _context: AppDbContext
    + GetAllAsync()
    + GetByIdAsync()
    + AddAsync()
    + UpdateAsync()
    + DeleteAsync()
    + GetBySparepartIdAsync()
    + GetByCenterIdAsync()
  }

  class SparepartReplenishmentRequestRepository <<Infrastructure>> {
    - _context: AppDbContext
    + GetAllAsync()
    + GetByIdAsync()
    + AddAsync()
    + UpdateAsync()
    + DeleteAsync()
    + GetByStatusAsync()
    + GetPendingAsync()
  }

  class SparepartUsageHistoryRepository <<Infrastructure>> {
    - _context: AppDbContext
    + GetAllAsync()
    + GetByIdAsync()
    + AddAsync()
    + UpdateAsync()
    + DeleteAsync()
    + GetBySparepartIdAsync()
    + GetByCenterIdAsync()
  }

  class InventoryRepository <<Infrastructure>> {
    - _context: AppDbContext
    + GetAllAsync()
    + GetByIdAsync()
    + AddAsync()
    + UpdateAsync()
    + GetByCenterIdAsync()
    + GetLowStockAsync()
  }
}

' ===== DOMAIN =====
package "Domain Layer" {
  class SparepartTuht <<Domain>> {
    + Sparepartid: Guid
    + Vehiclemodelid: int?
    + Inventoryid: Guid?
    + Typeid: Guid?
    + Name: string
    + Unitprice: decimal?
    + Manufacture: string?
    + Status: string?
    + Isactive: bool?
    + Createdat: DateTime?
    + Updatedat: DateTime?
  }

  class SpareparttypeTuht <<Domain>> {
    + Typeid: Guid
    + Name: string
    + Description: string?
    + Status: string?
    + Isactive: bool?
    + Createdat: DateTime?
    + Updatedat: DateTime?
  }

  class SparepartforecastTuht <<Domain>> {
    + Forecastid: Guid
    + Sparepartid: Guid
    + Centerid: Guid
    + Predictedusage: int?
    + Safetystock: int?
    + Reorderpoint: int?
    + Forecastedby: string?
    + Forecastconfidence: decimal?
    + Forecastdate: DateTime?
    + Approvedby: Guid?
    + Approveddate: DateTime?
    + Status: string?
    + Isactive: bool?
    + Createdat: DateTime?
    + Updatedat: DateTime?
  }

  class Sparepartreplenishmentrequest <<Domain>> {
    + Requestid: Guid
    + Centerid: Guid
    + Sparepartid: Guid
    + Forecastid: Guid?
    + Suggestedquantity: int?
    + Approvedby: Guid?
    + Approvedat: DateTime?
    + Notes: string?
    + Status: string?
    + Isactive: bool?
    + Createdat: DateTime?
    + Updatedat: DateTime?
  }

  class SparepartusagehistoryTuht <<Domain>> {
    + Usageid: Guid
    + Sparepartid: Guid
    + Centerid: Guid
    + Ordersparepartid: Guid?
    + Quantityused: int
    + Useddate: DateTime?
    + Status: string?
    + Isactive: bool?
    + Createdat: DateTime?
    + Updatedat: DateTime?
  }

  class InventoryTuht <<Domain>> {
    + Inventoryid: Guid
    + Centerid: Guid
    + Quantity: int?
    + Minimumstocklevel: int?
    + Status: string?
    + Isactive: bool?
    + Createdat: DateTime?
    + Updatedat: DateTime?
  }

  class Centertuantm <<Domain>> {
    + Centerid: Guid
    + Name: string
    + Address: string?
    + Phone: string?
  }

  class Vehiclemodel <<Domain>> {
    + Vehiclemodelid: int
    + Modelname: string
    + Manufacturer: string?
  }

  class Ordersparepart <<Domain>> {
    + Ordersparepartid: Guid
    + Orderid: Guid
    + Sparepartid: Guid
    + Quantity: int
  }
}

' ===== RELATIONSHIPS =====

' WebAPI to Application
SparepartController --> ISparepartService : calls
SparepartTypeController --> ISparepartTypeService : calls
SparepartForecastController --> ISparepartForecastService : calls
SparepartReplenishmentRequestController --> ISparepartReplenishmentRequestService : calls
SparepartUsageHistoryController --> ISparepartUsageHistoryService : calls
InventoryController --> IInventoryService : calls

' Application to Infrastructure
ISparepartService <|.. SparepartService : implements
ISparepartTypeService <|.. SparepartTypeService : implements
ISparepartForecastService <|.. SparepartForecastService : implements
ISparepartReplenishmentRequestService <|.. SparepartReplenishmentRequestService : implements
ISparepartUsageHistoryService <|.. SparepartUsageHistoryService : implements
IInventoryService <|.. InventoryService : implements

' Service to UnitOfWork
SparepartService --> IUnitOfWork : uses
SparepartTypeService --> IUnitOfWork : uses
SparepartForecastService --> IUnitOfWork : uses
SparepartReplenishmentRequestService --> IUnitOfWork : uses
SparepartUsageHistoryService --> IUnitOfWork : uses
InventoryService --> IUnitOfWork : uses

' UnitOfWork to Repositories
IUnitOfWork --> ISparepartRepository : provides
IUnitOfWork --> ISparepartTypeRepository : provides
IUnitOfWork --> ISparepartForecastRepository : provides
IUnitOfWork --> ISparepartReplenishmentRequestRepository : provides
IUnitOfWork --> ISparepartUsageHistoryRepository : provides
IUnitOfWork --> IInventoryRepository : provides

' Repository Interfaces to Implementations
ISparepartRepository <|.. SparepartRepository : implements
ISparepartTypeRepository <|.. SparepartTypeRepository : implements
ISparepartForecastRepository <|.. SparepartForecastRepository : implements
ISparepartReplenishmentRequestRepository <|.. SparepartReplenishmentRequestRepository : implements
ISparepartUsageHistoryRepository <|.. SparepartUsageHistoryRepository : implements
IInventoryRepository <|.. InventoryRepository : implements

' Repository to Domain
SparepartRepository --> SparepartTuht : manages
SparepartTypeRepository --> SpareparttypeTuht : manages
SparepartForecastRepository --> SparepartforecastTuht : manages
SparepartReplenishmentRequestRepository --> Sparepartreplenishmentrequest : manages
SparepartUsageHistoryRepository --> SparepartusagehistoryTuht : manages
InventoryRepository --> InventoryTuht : manages

' Domain Entity Relationships
SparepartTuht --> SpareparttypeTuht : has_type
SparepartTuht --> InventoryTuht : belongs_to
SparepartTuht --> Vehiclemodel : for_model
SparepartforecastTuht --> SparepartTuht : forecasts
SparepartforecastTuht --> Centertuantm : for_center
Sparepartreplenishmentrequest --> SparepartTuht : requests
Sparepartreplenishmentrequest --> Centertuantm : at_center
Sparepartreplenishmentrequest --> SparepartforecastTuht : based_on
SparepartusagehistoryTuht --> SparepartTuht : tracks
SparepartusagehistoryTuht --> Centertuantm : at_center
SparepartusagehistoryTuht --> Ordersparepart : from_order
InventoryTuht --> Centertuantm : at_center

@enduml
